from flask import Flask
from flask import render_template
from flask import request
from analyzer import analyze as la
from flask_limiter import Limiter
from flask_limiter.util import get_remote_address
import os

app = Flask(__name__)


limiter = Limiter(
    app,
    key_func=get_remote_address,
    default_limits=["3 per minute"]
)


@app.route("/")
def hello_world():
    return render_template('main.html')

@app.route("/analyze", methods=["POST"])
def analyze():
  if request.method == "POST":
    form=request.form
    result = la(form["apikey"], form["scanid"])
    if type(result) == str:
      return render_template('error.html', err = result)
    return render_template('result.html', eps=result[0], hosts=result[1], scanid = form["scanid"])
  

if __name__ == "__main__":
    port = int(os.environ.get('PORT', 5000))
    app.run(debug=True, host='0.0.0.0', port=port)